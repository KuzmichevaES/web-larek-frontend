# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

При реализации данного проекта используется архитектурный паттерн ModelViewPresenter.

## Слой Model

# Базовый код
1. Класс Model принимает параметр типа T (дженерик). Конструктор класса принимает два параметра: data с параметром Partial<T> и events типа IEvents. Data присвается экземпляру класса при помощи Object.assign. У класса есть метод emitChanges, который принимает параметр event: string (название события) и необязательный параметр payload?: object (данные). Данный метод вызывает метод emit, передавая ему параметры. Класс необходим для генерации событий.

2. Класс Api обеспечивающий взаимодействие с сервером при помощи методов 'POST' | 'PUT' | 'DELETE'. Имеет два свойства: baseUrl: string (получающий базовый URL), options: RequestInit (параметры для запросов). Класс имеет конструктор, который принимает два аргумента: baseUrl, options. Имеет следующие методы:
- handleResponse(response: Response) - обработка полученного ответа, ассинхронный метод, принимающий параметр response (ответ на запрос) с параметром Response;
- get(uri: string) - ассинхронный метод для получения данных с сервера, принимающий URI строкой;
- post(uri: string, data: object, method: ApiPostMethods = 'POST') - ассинхронный метод для отправки данных на сервер. Параметрами принимает URI строкой, данный объектом и тип используемого метода - POST.
Типы класса:
type ApiListResponse<Type> = {
    total: number,
    items: Type[]
}
type ApiPostMethods = 'POST' | 'PUT' | 'DELETE'

# Код для текущего проекта
1. Класс LarekAPI расширяющий базовый класс Api и реализующий интерфейс ILarekAPI. Имеет свойство cdn в виде строки. Конструктор класса принимает три параметра: cdn: string (со ссылкой cdn), baseUrl: string (базовый URL), options?: RequestInit (параметры для запросов, необязательно). Вызывает родительский конструктор, передавая ему параметры baseUrl и options и присваивает экземпляру класса параметр cdn.
Класса имеет следующие методы:
 - getProductList() - ассинхронный метод получения данных всех товаров с сервера;
- getProduct(id: string) - ассинхронный метод, принимающий параметром id (строка) товара и получающий с сервера все данные товара с указанным id;  
- sendOrder(order: IOrder) - ассинхронный метод, принимающий параметром order (типа IOrder) с данными заказа и передающий эти данные на сервер.
Интерфейс ILarekAPI {
    getProductList: () => Promise<IProduct[]>;
    getProduct: (id: string) => Promise<IProduct>;
    sendOrder: (order: IOrder) => Promise<OrderResult>;

2. Класс ProductItem хранит данные о товаре, расширяет базовый класс Model. 
Имеет следующие свойства:
    id: string; - id товара
    description: string; - описание товара
    image: string; - картинка товара
    title: string; - заголовок товара (краткое описание)
    category: string; - категория товара
    price: number | null; - цена товара

Класс реализует интерфейс 
interface IProduct {
    id: string;
    description?: string;
    image?: string;
    title: string;
    category?: string;
    price: number | null;
}

3. Класс AppState хранящий данные приложения, , расширяет базовый класс Model. 
Имеет следующие свойства:
    catalog: IProduct[] = []; - каталог товаров, состоящий из массива товаров
    basket: IProduct[] = []; - корзина с массивом товаров
    order: IOrder = {
        payment: '',
        address: '',
        email: '',
        phone: '',
        items: [],
        total: 0
    }; - заказ, хранящий все данные о заказе (метод оплаты, адрес доставки, email, телефон, товары в заказе, итоговая стоимость заказа)
    formErrors: FormErrors = {}; - ошибки валидации форм

Данный класс имеет следующие методы:
- addToBasket(item: IProduct): void - метод добавления товара в корзину (не имеет значение, что метод возвращает), принимает item (товар) типа IProduct. Добавляет товар в корзину и вызывает событие itemsListBasket: changed (изменился состав корзины);
- removeFromBasket(id: string): void - метод удаления товара из корзины (не имеет значение, что метод возвращает), принимает id (id товара) типа string. Удаляет товар из корзины и вызывает событие itemsListBasket: changed (изменился состав корзины);
clearBasket(): void - метод сброса корзины. Удаляет все данные о товаре, находящемся в корзине, вызывает событие itemsListBasket: changed (изменился состав корзины) и сбрасывает данные заказа;
- clearOrder(): void - метод сброса данных заказа;
- getTotal(): number - метод возвращающий сумму всех товаров, находящихся в корзине;
- prepareOrderData(): void - метод, подготавливающий данные для отправки данных заказа. Собирает id товара из массива товаров в корзине, исключая бесценный товар, получает итоговую сумму заказа при помощи метода getTotal;
- setCatalog(items: IProduct[]) - метод, принимающий items массив товаров типа IProduct[], устанавливающий данные текущего каталога и вызывающий событие items:changed (изменились товары в каталоге);
- isProductInBasket(item: IProduct): boolean - метод, возвращающий данные типа boolean и проверяющий наличие определенного товара в корзине по переданному в метов товару (item) типа IProduct;
- setPreview(item: IProduct) - метод вызывающий событие preview:changed (изменилось описание товара)
- setBasket(modal: Modal, basket: Basket): void - метод, устанавливающий данные в корзину - список товаров и общую стоимость;
- setAddress(value: string): void - метод, устанавливающий адрес в заказ и вызывающий метод валидации формы;
- setPaymentMethod(value: string): void - метод, устанавливающий выбранный способ оплаты заказа в заказ и вызывающий метод валидации формы;
- setContacts(field: keyof IOrderFormContacts, value: string) - метод, устанавливающий указанные контактные данные в заказ и вызывающий метод валидации формы;
- validateOrderPaymentAddress() - метод валидации формы выбора метода оплаты и адреса. Проверяет валидность полей, вносит текст ошибок, вызывает событие formErrors:change (изменились ошибки формы).

Класс реализует интерфейс IAppState
interface IAppState {
    catalog: IProduct[];
    basket: string[];
    order: IOrder | null;
}

## Слой View

# Базовый код
1. Абстрактный класс Component, принимающий дженерик параметр <T>. В конструктор принимает контейнер типа HTMLElement. 
Имеет следующие методы:
- toggleClass(element: HTMLElement, className: string, force?: boolean) - метод, который меняет класс HTML-элемента, принимает сам элемент типа HTMLElement, название класса string и необязательный параметр force типа boolean, который определяет нужно добавить или удалить класс;
- setText(element: HTMLElement, value: unknown) - метод установления текстового контента в HTML-элемент. Принимает сам HTML-элемент типа HTMLElement и значение типа unknown;
- set(element: HTMLElement, state: boolean) - метод, устанавливающий/снимающий атрибут disabled HTML-элементу. Принимает сам HTML-элемент типа HTMLElement и параметр типа boolean, указывающий на наличие/отсутствие атрибута у элемента;
- setHidden(element: HTMLElement) - метод, скрывающий HTML-элемент путём установления стиля display = 'none'. Принимает элемент типа HTMLElement;
- setVisible(element: HTMLElement) метод, показывающий HTML-элемент путём снятия стиля display = 'none'. Принимает элемент типа HTMLElement;
- setImage(element: HTMLImageElement, src: string, alt?: string) - метод, устанавлиающий изображение в HTML-элемент. Принимает элемент типа HTMLElement, src типа string (ссылка на изображение) и необязательный параметр alt типа string (текстовое описание изображения);
- render(data?: Partial<T>): HTMLElement - метод для отрисовки приложения, возврщающий HTML-элемент.

# Код для текущего проекта
1. Класс Basket расширяет базовый класс Component и реализует интерфейс:
interface IBasketView {
    items: IProduct[];
    total: number;
}.
Класс имеет три свойства:
_list: HTMLElement (список товаров в корзине)
_total: HTMLElement (общая стомость заказа)
_button: HTMLElement (кнопка для перехода далее).
Конструктор принимает контейнер типа HTMLElement и события, вызывает родительский конструктор, передав полученный контейнер и присваивает свойствам HTML-элементы разметки приложения, а также навешивает слушатель клика на кнопку, который при срабатывании вызывает событие order:open (открыта форма заказа). Конструктор присваивает списку элементов пустой массив.
Класс имеет следущие методы:
- set items(items: IProduct[]) - сеттер класса, устанавлиает список элементов в разметке приложения и рендерит содержимое корзины. Принимает массив товаров типа IProduct[];
- set total(total: number) - сетттер класса для записи в HTML-элемент итоговой стоимости всех товаров в корзине, принимает параметр total типа number; 
- setButtonState() - метод для изменения состояния кнопки корзины. 

2. Класс BasketItem расширяет базовый класс Component и реализует интерфейс:
interface IBasketItemView {
    counter: number;
    title: string;
    price: number;
}.
Класс необходим для отображения товара в списке товаров в корзине и имеет три свойства:
_title: HTMLElement - заголовок товара
_price: HTMLElement - цену товара
_deleteButton: HTMLButtonElement - кнопка удаления товара из корзины
Конструктор принимает контейнер типа HTMLElement и события (необязательный параметр), вызывает родительский конструктор, передав полученный контейнер и присваивает свойствам HTML-элементы разметки приложения, а также навешивает слушатель клика на кнопку удаления.
Класс имеет следущие методы:
- set counter(value: string) - сеттер класса, устанавливающий порядковый номер товара в корзине;
- set title(value: string) - сеттер класса, устанавливающий название товара; 
- set price(value: number) - сеттер класса, устанавливающий цену товара.

3. Класс Form принимающий параметр типа <T> (дженерик), расширяет базовый класс Component и реализует интерфейс:
IFormState {
    valid: boolean;
    errors: string[];
}.
Имеет два свойства:
_submit: HTMLButtonElement - кнопка сабмита формы
_errors: HTMLElement - ошибки (для вывода ошибок валидации формы)
Конструктор принимает контейнер типа HTMLElement и события, вызывает родительский конструктор, передав полученный контейнер и присваивает свойствам HTML-элементы разметки приложения, а также навешивает слушатель на инпут, на элемент сабмита формы.
Имеет следующие методы:
- onInputChange(field: keyof T, value: string) метод, вызывающий событие изменения конкретной формы; 
- set valid(value: boolean) - сеттер, блокирует кнопку, если поле не валидно;
- set errors(value: string) - сеттер для установки текста ошибок;
- render(state: Partial<T> & IFormState) - метод рендера формы.

4. Класс Modal расширяет базовый класс Component и реализует интерфейс:
interface IModalData {
    content: HTMLElement;
}.
Необходим для отрисовки модального окна. Имеет два свойства:
_closeButton: HTMLButtonElement - кнопка закрытия модалки
_content: HTMLElement - контент модального окна.
Конструктор принимает контейнер типа HTMLElement и события, вызывает родительский конструктор, передав полученный контейнер и присваивает свойствам HTML-элементы разметки приложения, а также навешивает слушатель на кнопку закрытия формы, на контейнер и останавливает всплытие.
Имеет следующие методы:
- set content(value: HTMLElement) - сеттер, устанавливает контент модального окна;
- open() - метод открытия модалки. Вызывает событие modal:open (открыто модальное окно);
- close() - метод закрытия модалки. Удаляет класс контейнера, вызывает событие modal:close (закрыто модальное окно);
- render(data: IModalData): HTMLElement - отрисовка модального окна.

5. Класс Success расширяет базовый класс Component и реализует интерфейс:
interface ISuccess {
    totalPrice: number;
}
Имеет два свойства:
_close: HTMLElement - кнопка закрытия окна
_totalPrice: HTMLElement - итоговая сумма заказа
Конструктор принимает контейнер типа HTMLElement, события и итоговую сумму заказа, вызывает родительский конструктор, передав полученный контейнер и присваивает свойствам HTML-элементы разметки приложения, а также навешивает слушатель на кнопку закрытия формы.

6. Класс export class Card, принимает параметр типа <T> (дженерик) расширяет базовый класс Component.
Необходим для отрисовки карточки товара и содержит следующие свойства:
_title: HTMLElement - название товара
_image?: HTMLImageElement - изображение товара (необязательно)
_description?: HTMLElement - описание товара (необязательно)
_button?: HTMLButtonElement - кнопка (необязательно)
_category?: HTMLElement - категория товара (необязательно)
_price: HTMLElement - цена товара.
Конструктир принимает blockName: string (название блока в разметке), container: HTMLElement (контейнер), actions?: ICardActions (действия).
Вызывает родительский конструктор, передав полученный контейнер и присваивает свойствам HTML-элементы разметки приложения, а также навешивает слушатель на кнопку карточки (если она есть или на саму карточку).
Класс имеет следующие методы:
- set id(value: string) - сеттер для установления значения id товара;
- set title(value: string) - сеттер для установления значения названия товара;
- set category(value: string) - сеттер для установления значения категории товара;
- set price(value: number) - сеттер для установления значения цены товара;
- get price() - геттер для получения цены товара и установки ее значения в текстовый контент элемента;
- set image(value: string) - сеттер для установления значения изображения товара;
- set description(value: string | string[]) - сеттер для установления описания товара; 
- setButtonState() - сеттер для установления состояния кнопки.

7. Класс class OrderPaymentAddress для отображения формы первого этапа заказа (выбор метода оплаты и ввод адреса доставки), расширяет  класс Form<IOrderFormPaymentAddress>, реализует интерфейс:
interface IOrderFormPaymentAddress {
    payment: IOrderPaymentWay;
    address: string;
}.
Имеет свойство _buttonsPayment: HTMLButtonElement[] - кнопки выбора способа оплаты.
Конструктор принимает контейнер типа HTMLElement и события, вызывает родительский конструктор, передав полученный контейнер с событями и присваивает свойствам HTML-элементы разметки приложения, а также навешивает слушатель на все кнопки выбора способа оплаты, вызывает событие paymentMethod:changed (изменился способ оплаты).
Класс имеет следующие методы:
- set address(value: string) - устанавливает значение адреса;
- setPaymentButtonClass(name: string): void - устанавливает для выбранной кнопки класс (для корректного отображения на странице).

8. Класс OrderContact для отображения формы второго этапа заказа (ввод контактных данных заказа), расширяет  класс Form и реализует интерфейс:
interface IOrderFormContacts {
    email: string;
    phone: string;
}.
Конструктор принимает контейнер типа HTMLElement и события, вызывает родительский конструктор, передав полученный контейнер с событями и присваивает свойствам HTML-элементы разметки приложения.
Класс имеет следующие методы:
- set phone(value: string) - устанавливает значения номера телефона покупателя;
- set email(value: string) - устанавливает значения электронной почты покупателя.

9. Класс Page для отрисовки приложения. Расширяет базовый класс Component и реализует интерфейс 
interface IPage {
    counter: number;
    catalog: HTMLElement[];
    locked: boolean;
}.
Имеет свойства:
_counter: HTMLElement - счетчик товаров в корзине для отображение количества товаров, находящихся там;
_catalog: HTMLElement - каталог карточек;
_wrapper: HTMLElement - элемент для запрета прокрутки страницы при открытых модальных окнах;
_basket: HTMLElement - элемент корзины.
Конструктор принимает контейнер типа HTMLElement и события, вызывает родительский конструктор, передав полученный контейнер с событями и присваивает свойствам HTML-элементы разметки приложения и навешивает слушатель на элемент корзины, вызывает событие basket:open (корзина открыта).
Имеет следубщие методы:
- set counter(value: number) - устанавлиает значение счетчика товаров в корзине;
- set catalog(items: HTMLElement[]) - устанавливает каталог товаров на странице;
- set locked(value: boolean) - блокирует прокрутку страницы.

## Слой Presenter

# Базовый код
1. Класс EventEmitter - брокер событий, с помощью которого связываются слой Model и View, реализует интерфейс:
interface IEvents {
    on<T extends object>(event: EventName, callback: (data: T) => void): void;
    emit<T extends object>(event: string, data?: T): void;
    trigger<T extends object>(event: string, context?: Partial<T>): (data: T) => void;
}.
Имеет свойство - _events: Map<EventName, Set<Subscriber>> (объект событие (ключ) - значение (подписчик))
В конструкторе создается новый объект с событиями и подписчиками и присвается свойству _events потомков класса.
Имеет следующие методы:
- on<T extends object>(eventName: EventName, callback: (event: T) => void) - Установить обработчик на событие;
- off(eventName: EventName, callback: Subscriber) - Снять обработчик с события;
- emit<T extends object>(eventName: string, data?: T) - Инициировать событие с данными;
- onAll(callback: (event: EmitterEvent) => void) - Слушать все события;
- offAll() - Сбросить все обработчики;
- trigger<T extends object>(eventName: string, context?: Partial<T>) - Сделать коллбек триггер, генерирующий событие при вызове.



## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
