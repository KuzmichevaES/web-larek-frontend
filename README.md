# Проектная работа "Веб-ларек"

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

При реализации данного проекта используется архитектурный паттерн ModelViewPresenter.

# Слой Model

## Базовый код
1. Класс `Model` принимает параметр типа T (дженерик). Необходим для создания объекта и хранения в нем данных приложения.

`constructor(data: Partial<T>, protected events: IEvents)` - принимает два параметра: данные с параметром Partial<T> и события типа IEvents. Данные присваиваются экземпляру класса при помощи Object.assign. 
У класса есть метод `emitChanges`, который принимает параметр название событиясобытия в виде строки и необязательный параметр с данными типа объект. Данный метод вызывает метод emit, передавая ему параметры. Класс необходим для генерации событий.

2. Класс `Api` обеспечивает взаимодействие с сервером при помощи методов 'POST' | 'PUT' | 'DELETE'. 
Имеет два свойства: baseUrl: string (получающий базовый URL), options: RequestInit (параметры для запросов). 

`constructor(baseUrl: string, options: RequestInit = {})` - принимает два аргумента: базовый baseUrl строкой, параметры запроса. 
Имеет следующие методы:
`handleResponse` - обработка полученного ответа, ассинхронный метод, принимающий параметр response (ответ на запрос) с параметром Response;
`get` - ассинхронный метод для получения данных с сервера, принимающий URI строкой;
`post` - ассинхронный метод для отправки данных на сервер. Параметрами принимает URI строкой, данный объектом и тип используемого метода - POST.

Типы класса:
type ApiListResponse<Type> = {
    total: number,
    items: Type[]
}
type ApiPostMethods = 'POST' | 'PUT' | 'DELETE'

## Код для текущего проекта
1. Класс `LarekAPI` для обмена данными между сервером и приложением.
Расширяет базовый класс Api и реализующий интерфейс ILarekAPI. Имеет свойство cdn в виде строки. 

`constructor(cdn: string, baseUrl: string, options?: RequestInit)` - принимает три параметра: cdn: string (со ссылкой cdn типа строка), baseUrl: string (базовый URL типа строка), options?: RequestInit (параметры для запросов, необязательно). Вызывает родительский конструктор, передавая ему параметры baseUrl и options и присваивает экземпляру класса параметр cdn.

Класса имеет следующие методы:
`getProductList` - ассинхронный метод получения данных всех товаров с сервера;
`getProduct` - ассинхронный метод, принимающий параметром id (строка) товара и получающий с сервера все данные товара с указанным id;  
`sendOrder` - ассинхронный метод, принимающий параметром order (типа IOrder) с данными заказа и передающий эти данные на сервер.

Интерфейс ILarekAPI {
    getProductList: () => Promise<IProduct[]>;
    getProduct: (id: string) => Promise<IProduct>;
    sendOrder: (order: IOrder) => Promise<OrderResult>;

2. Класс `ProductItem` создан для хранения данных о товаре, расширяет базовый класс Model. 
Имеет следующие свойства:
    id: string; - id товара
    description: string; - описание товара
    image: string; - картинка товара
    title: string; - заголовок товара (краткое описание)
    category: string; - категория товара
    price: number | null; - цена товара

Класс реализует интерфейс 
interface IProduct {
    id: string;
    description?: string;
    image?: string;
    title: string;
    category?: string;
    price: number | null;
}

3. Класс `AppState` хранит текущие данные приложения, расширяет базовый класс Model. 
Имеет следующие свойства:
    catalog: IProduct[] = []; - каталог товаров, состоящий из массива товаров
    basket: IProduct[] = []; - корзина с массивом товаров
    order: IOrder = {
        payment: '',
        address: '',
        email: '',
        phone: '',
        items: [],
        total: 0
    }; - заказ, хранящий все данные о заказе (метод оплаты, адрес доставки, email, телефон, товары в заказе, итоговая стоимость заказа)
    formErrors: FormErrors = {}; - ошибки валидации форм

Данный класс имеет следующие методы:
`addToBasket` - метод добавления товара в корзину (не имеет значение, что метод возвращает), принимает item (товар) типа IProduct. Добавляет товар в корзину и вызывает событие itemsListBasket: changed (изменился состав корзины);
`removeFromBasket` - метод удаления товара из корзины (не имеет значение, что метод возвращает), принимает id (id товара) типа string. Удаляет товар из корзины и вызывает событие itemsListBasket: changed (изменился состав корзины);
`clearBasket` - метод сброса корзины. Удаляет все данные о товаре, находящемся в корзине, вызывает событие itemsListBasket: changed (изменился состав корзины) и сбрасывает данные заказа;
`clearOrder` - метод сброса данных заказа;
`getTotal` - метод возвращающий сумму всех товаров, находящихся в корзине;
`prepareOrderData` - метод, подготавливающий данные для отправки данных заказа. Собирает id товара из массива товаров в корзине, исключая бесценный товар, получает итоговую сумму заказа при помощи метода getTotal;
`setCatalog` - метод, принимающий items массив товаров типа IProduct[], устанавливающий данные текущего каталога и вызывающий событие items:changed (изменились товары в каталоге);
`isProductInBasket` - метод, возвращающий данные типа boolean и проверяющий наличие определенного товара в корзине по переданному в метов товару (item) типа IProduct;
`setPreview` - метод вызывающий событие preview:changed (изменилось описание товара)
`setBasket` - метод, устанавливающий данные в корзину - список товаров и общую стоимость;
`setAddress` - метод, устанавливающий адрес в заказ и вызывающий метод валидации формы;
`setPaymentMethod` - метод, устанавливающий выбранный способ оплаты заказа в заказ и вызывающий метод валидации формы;
`setContacts` - метод, устанавливающий указанные контактные данные в заказ и вызывающий метод валидации формы;
`validateOrderPaymentAddress` - метод валидации формы выбора метода оплаты и адреса. Проверяет валидность полей, вносит текст ошибок, вызывает событие formErrors:change (изменились ошибки формы).

Класс реализует интерфейс IAppState
interface IAppState {
    catalog: IProduct[];
    basket: string[];
    order: IOrder | null;
}

# Слой View

## Базовый код

1. Абстрактный класс `Component` предназначен для создания подклассов других классов для обеспечения конкретных реализаций его методов.

`constructor(protected readonly container: HTMLElement)` контейнер принимает контейнер, куда будет помещен компонеет. 
Имеет следующие методы:
`toggleClass` - метод, который меняет класс HTML-элемента, принимает сам элемент типа HTMLElement, название класса string и необязательный параметр force типа boolean, который определяет нужно добавить или удалить класс;
`setText` - метод установления текстового контента в HTML-элемент. Принимает сам HTML-элемент типа HTMLElement и значение типа unknown;
`set` - метод, устанавливающий/снимающий атрибут disabled HTML-элементу. Принимает сам HTML-элемент типа HTMLElement и параметр типа boolean, указывающий на наличие/отсутствие атрибута у элемента;
`setHidden`- метод, скрывающий HTML-элемент путём установления стиля display = 'none'. Принимает элемент типа HTMLElement;
`setVisible` - метод, показывающий HTML-элемент путём снятия стиля display = 'none'. Принимает элемент типа HTMLElement;
`setImage` - метод, устанавлиающий изображение в HTML-элемент. Принимает элемент типа HTMLElement, src типа string (ссылка на изображение) и необязательный параметр alt типа string (текстовое описание изображения);
`render` - метод для отрисовки приложения, возврщающий HTML-элемент.

## Код для текущего проекта
1. Класс `Basket` необходим для отображения компонета корзины приложения и упралвения действиями данного компонента, ррасширяет базовый класс Component и реализует интерфейс:
interface IBasketView {
    items: IProduct[];
    total: number;
}.
Класс имеет три свойства:
_list: HTMLElement (список товаров в корзине)
_total: HTMLElement (общая стомость заказа)
_button: HTMLElement (кнопка для перехода далее).

`constructor(container: HTMLElement, protected events: EventEmitter)` принимает контейнер с компонетов и события, вызывает родительский конструктор, передав полученный контейнер и присваивает свойствам HTML-элементы разметки приложения, а также навешивает слушатель клика на кнопку, который при срабатывании вызывает событие order:open (открыта форма заказа). Конструктор присваивает списку элементов пустой массив.

Класс имеет следущие методы:
`set items` - сеттер класса, устанавлиает список элементов в разметке приложения и рендерит содержимое корзины. Принимает массив товаров типа IProduct[];
`set total`- сетттер класса для записи в HTML-элемент итоговой стоимости всех товаров в корзине, принимает параметр total типа number; 
`setButtonState` - метод для изменения состояния кнопки корзины. 

2. Класс `BasketItem`  необходим для отображения товара в списке товаров в корзине, расширяет базовый класс Component и реализует интерфейс:
interface IBasketItemView {
    counter: number;
    title: string;
    price: number;
}.
Имеет три свойства:
_title: HTMLElement - заголовок товара
_price: HTMLElement - цену товара
_deleteButton: HTMLButtonElement - кнопка удаления товара из корзины

`constructor(protected container: HTMLElement, actions?: ICardActions)` принимает контейнер с компонентом и события (необязательный параметр), вызывает родительский конструктор, передав полученный контейнер и присваивает свойствам HTML-элементы разметки приложения, а также навешивает слушатель клика на кнопку удаления.

Класс имеет следущие методы:
`set counter` - сеттер класса, устанавливающий порядковый номер товара в корзине;
`set title` - сеттер класса, устанавливающий название товара; 
`set price` - сеттер класса, устанавливающий цену товара.

3. Класс `Form` необходим для отобюражения компонента формы, принимающий параметр типа <T> (дженерик), расширяет базовый класс Component и реализует интерфейс:
IFormState {
    valid: boolean;
    errors: string[];
}.
Имеет два свойства:
_submit: HTMLButtonElement - кнопка сабмита формы
_errors: HTMLElement - ошибки (для вывода ошибок валидации формы)

`constructor(protected container: HTMLFormElement, protected events: IEvents)` принимает контейнер с компонентом формы и события, вызывает родительский конструктор, передав полученный контейнер и присваивает свойствам HTML-элементы разметки приложения, а также навешивает слушатель на инпут, на элемент сабмита формы.

Имеет следующие методы:
`onInputChange` - метод, вызывающий событие изменения конкретной формы; 
`set valid` - сеттер, блокирует кнопку, если поле не валидно;
`set errors` - сеттер для установки текста ошибок;
`render` - метод рендера формы.

4. Класс `Modal` для отображения и управления компонентом модального окна, расширяет базовый класс Component и реализует интерфейс:
interface IModalData {
    content: HTMLElement;
}.
Необходим для отрисовки модального окна. Имеет два свойства:
_closeButton: HTMLButtonElement - кнопка закрытия модалки
_content: HTMLElement - контент модального окна.
`constructor(container: HTMLElement, protected events: IEvents)` принимает контейнер с компонентом и события, вызывает родительский конструктор, передав полученный контейнер и присваивает свойствам HTML-элементы разметки приложения, а также навешивает слушатель на кнопку закрытия формы, на контейнер и останавливает всплытие.

Имеет следующие методы:
`set content` - сеттер, устанавливает контент модального окна;
`open` - метод открытия модалки. Вызывает событие modal:open (открыто модальное окно);
`close` - метод закрытия модалки. Удаляет класс контейнера, вызывает событие modal:close (закрыто модальное окно);
`render` - отрисовка модального окна.

5. Класс `Success` для отображения окна успешно совершенного заказа, расширяет базовый класс Component и реализует интерфейс:
interface ISuccess {
    totalPrice: number;
}
Имеет два свойства:
_close: HTMLElement - кнопка закрытия окна
_totalPrice: HTMLElement - итоговая сумма заказа

`constructor(container: HTMLElement, actions: ISuccessActions, total: number)` принимает контейнер компонента, события и итоговую сумму заказа числом, вызывает родительский конструктор, передав полученный контейнер и присваивает свойствам HTML-элементы разметки приложения, а также навешивает слушатель на кнопку закрытия формы.

6. Класс  `Card`, Необходим для отрисовки карточки товара, принимает параметр типа <T> (дженерик) расширяет базовый класс Component.
Содержит следующие свойства:
_title: HTMLElement - название товара
_image?: HTMLImageElement - изображение товара (необязательно)
_description?: HTMLElement - описание товара (необязательно)
_button?: HTMLButtonElement - кнопка (необязательно)
_category?: HTMLElement - категория товара (необязательно)
_price: HTMLElement - цена товара.

`constructor(protected blockName: string, container: HTMLElement, actions?: ICardActions)` принимает название блока в разметке строкой, контейнер компонена, действия.
Вызывает родительский конструктор, передав полученный контейнер и присваивает свойствам HTML-элементы разметки приложения, а также навешивает слушатель на кнопку карточки (если она есть или на саму карточку).

Класс имеет следующие методы:
`set id` - сеттер для установления значения id товара;
`set title` - сеттер для установления значения названия товара;
`set category` - сеттер для установления значения категории товара;
`set price` - сеттер для установления значения цены товара;
`get price` - геттер для получения цены товара и установки ее значения в текстовый контент элемента;
`set image` - сеттер для установления значения изображения товара;
`set description` - сеттер для установления описания товара; 
`setButtonState` - для установления состояния кнопки;
`setSelectedProductButton` - для изменения текста кнопки товара, который уже находится в корзине.

7. Класс `OrderPaymentAddress` для отображения и управдения формой первого этапа заказа (выбор метода оплаты и ввод адреса доставки), расширяет  класс Form<IOrderFormPaymentAddress>, реализует интерфейс:
interface IOrderFormPaymentAddress {
    payment: IOrderPaymentWay;
    address: string;
}.
Имеет свойство _buttonsPayment: HTMLButtonElement[] - кнопки выбора способа оплаты.

`constructor(container: HTMLFormElement, events: IEvents)` принимает контейнер компонента и события, вызывает родительский конструктор, передав полученный контейнер с событями и присваивает свойствам HTML-элементы разметки приложения, а также навешивает слушатель на все кнопки выбора способа оплаты, вызывает событие paymentMethod:changed (изменился способ оплаты).

Класс имеет следующие методы:
`set address` - устанавливает значение адреса;
`setPaymentButtonClass` - устанавливает для выбранной кнопки класс (для корректного отображения на странице).

8. Класс `OrderContact` для отображения и управления формой второго этапа заказа (ввод контактных данных заказа), расширяет класс Form и реализует интерфейс:
interface IOrderFormContacts {
    email: string;
    phone: string;
}.
`constructor(container: HTMLFormElement, events: IEvents)` принимает контейнер компонента и события, вызывает родительский конструктор, передав полученный контейнер с событями и присваивает свойствам HTML-элементы разметки приложения.

Класс имеет следующие методы:
`set phone` - устанавливает значения номера телефона покупателя;
`set email` - устанавливает значения электронной почты покупателя.

9. Класс `Page` для отрисовки и управлением страницы приложения. Расширяет базовый класс Component и реализует интерфейс 
interface IPage {
    counter: number;
    catalog: HTMLElement[];
    locked: boolean;
}.
Имеет свойства:
_counter: HTMLElement - счетчик товаров в корзине для отображение количества товаров, находящихся там;
_catalog: HTMLElement - каталог карточек;
_wrapper: HTMLElement - элемент для запрета прокрутки страницы при открытых модальных окнах;
_basket: HTMLElement - элемент корзины.

`constructor(container: HTMLFormElement, events: IEvents)` принимает контейнер компонента и события, вызывает родительский конструктор, передав полученный контейнер с событями и присваивает свойствам HTML-элементы разметки приложения и навешивает слушатель на элемент корзины, вызывает событие basket:open (корзина открыта).

Имеет следующие методы:
`set counter` - устанавлиает значение счетчика товаров в корзине;
`set catalog` - устанавливает каталог товаров на странице;
`set locked` - блокирует прокрутку страницы.

# Слой Presenter

## Базовый код

1. Класс `EventEmitter` - брокер событий, с помощью которого связываются слой Model и View, реализует интерфейс:
interface IEvents {
    on<T extends object>(event: EventName, callback: (data: T) => void): void;
    emit<T extends object>(event: string, data?: T): void;
    trigger<T extends object>(event: string, context?: Partial<T>): (data: T) => void;
}.
Имеет свойство - _events: Map<EventName, Set<Subscriber>> (объект событие (ключ) - значение (подписчик))
`constructor()` ничего не принимает, но создает новый объект с событиями и подписчиками и присвает свойству _events потомков класса.

Имеет следующие методы:
`on` - Установить обработчик на событие;
`off` - Снять обработчик с события;
`emit` - Инициировать событие с данными;
`onAll` - Слушать все события;
`offAll` - Сбросить все обработчики;
`trigger` - Сделать коллбек триггер, генерирующий событие при вызове.

# Список событий

'items:changed' - изменился каталог
'card:selected' - выбрана карточка товара
'preview:changed' - изменилось отображение страницы приложения
'card:addedToBasket' - товар добавлен в корзину
'card:removeFromBasket' - товар удален из корзины
'itemsListBasket: changed' - изменился список товаров в корзине
'basket:open' - открылась корзина
'order:open' - открылся заказ, первый этап оформления
'paymentMethod:changed' - изменился метод оплаты
'order:submit' - завершен первый этап оформления заказа
'contacts:submit' - завершен второй этап оформления заказа
'modal:open' - открылось модальное окно
'modal:close' - закрылось модальное окно
/^contacts\..*:change/ - изменилось одно из полей для ввода контактных данных
/^order\..*:change/ -  изменилось одно из полей первого этапа оформления заказа
'formErrors:change' - изменились ошибки валидации

